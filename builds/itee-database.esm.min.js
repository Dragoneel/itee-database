function normalizeArray(r,t){for(var e=0,n=r.length-1;n>=0;n--){var i=r[n];"."===i?r.splice(n,1):".."===i?(r.splice(n,1),e++):e&&(r.splice(n,1),e--)}if(t)for(;e--;e)r.unshift("..");return r}function resolve(){for(var r="",t=!1,e=arguments.length-1;e>=-1&&!t;e--){var n=e>=0?arguments[e]:"/";if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");n&&(r=n+"/"+r,t="/"===n.charAt(0))}return r=normalizeArray(filter(r.split("/"),function(r){return!!r}),!t).join("/"),(t?"/":"")+r||"."}function normalize(r){var t=isAbsolute(r),e="/"===substr(r,-1);return(r=normalizeArray(filter(r.split("/"),function(r){return!!r}),!t).join("/"))||t||(r="."),r&&e&&(r+="/"),(t?"/":"")+r}function isAbsolute(r){return"/"===r.charAt(0)}function join(){return normalize(filter(Array.prototype.slice.call(arguments,0),function(r,t){if("string"!=typeof r)throw new TypeError("Arguments to path.join must be strings");return r}).join("/"))}function relative(r,t){function e(r){for(var t=0;t<r.length&&""===r[t];t++);for(var e=r.length-1;e>=0&&""===r[e];e--);return t>e?[]:r.slice(t,e-t+1)}r=resolve(r).substr(1),t=resolve(t).substr(1);for(var n=e(r.split("/")),i=e(t.split("/")),o=Math.min(n.length,i.length),u=o,a=0;a<o;a++)if(n[a]!==i[a]){u=a;break}for(var s=[],a=u;a<n.length;a++)s.push("..");return(s=s.concat(i.slice(u))).join("/")}function dirname(r){var t=splitPath(r),e=t[0],n=t[1];return e||n?(n&&(n=n.substr(0,n.length-1)),e+n):"."}function basename(r,t){var e=splitPath(r)[2];return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e}function extname(r){return splitPath(r)[3]}function filter(r,t){if(r.filter)return r.filter(t);for(var e=[],n=0;n<r.length;n++)t(r[n],n,r)&&e.push(r[n]);return e}function isNotNull(r){return null!==r}function isNullOrUndefined(r){return null===r||void 0===r}function isDefined(r){return null!==r&&void 0!==r}function isEmpty(r){if(null===r)return!0;if(void 0===r)return!0;if(r.length>0)return!1;if(0===r.length)return!0;for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function isNotEmpty(r){return!isEmpty(r)}function isObject(r){return isNotNull(r)&&"object"==typeof r&&!Array.isArray(r)}function isNotEmptyObject(r){return isObject(r)&&isNotEmpty(r)}function isArray(r){return Array.isArray(r)}function isNotEmptyArray(r){return isArray(r)&&isNotEmpty(r)}function _isString(r){return"string"==typeof r||r instanceof String}function _isNullOrEmptyArray(r){return!r||r.constructor===Array&&0===r.length}function _isArray(r){return r.constructor===Array}function _isObject(r){return r===Object(r)}function _normalizeError(r){var t=[];if(_isArray(r))for(var e=0,n=r.length;e<n;++e)t=t.concat(_normalizeError(r[e]));else if(_isObject(r))if("ValidationError"===r.name){var i="",o=r.errors;for(var u in o)o.hasOwnProperty(u)&&(i+=o[u].message+"<br>");t.push({title:"Erreur de validation",message:i||"Aucun message d'erreur... Gloups !"})}else"VersionError"===r.name?t.push({title:"Erreur de base de donnée",message:"Aucun document correspondant n'as put être trouvé pour la requete !"}):t.push({title:r.title||"Erreur",message:r.message||"Aucun message d'erreur... Gloups !"});else{if(!_isString(r))throw new Error("Unknown error type: "+r+', please report your issue at "https://github.com/TristanVALCKE/i-return/issues"');t.push({title:"Erreur",message:r})}return t}function returnNotFound(r){return"function"==typeof r?r():r.headersSent?void 0:r.status(204).end()}function returnError(r,t){return"function"==typeof t?t(r,null):t.headersSent?void 0:t.status(500).end(JSON.stringify(r))}function returnData(r,t){return"function"==typeof t?t(null,r):t.headersSent?void 0:t.status(200).end(JSON.stringify(r))}function returnErrorAndData(r,t,e){return"function"==typeof e?e(r,t):e.headersSent?void 0:e.status(406).end(JSON.stringify({errors:r,data:t}))}function returnResponse(r,t){function e(t,e){s.beforeReturnErrorAndData&&s.beforeReturnErrorAndData(t,e),s.returnErrorAndData&&s.returnErrorAndData(t,e,r),s.afterReturnErrorAndData&&s.afterReturnErrorAndData(t,e)}function n(t){s.beforeReturnError&&s.beforeReturnError(t),s.returnError&&s.returnError(t,r),s.afterReturnError&&s.afterReturnError(t)}function i(t){s.beforeReturnData&&s.beforeReturnData(t),s.returnData&&s.returnData(t,r),s.afterReturnData&&s.afterReturnData(t)}function o(){s.beforeReturnNotFound&&s.beforeReturnNotFound(),s.returnNotFound&&s.returnNotFound(r),s.afterReturnNotFound&&s.afterReturnNotFound()}function u(r,t){if(s.beforeAll&&s.beforeAll(),s.returnForAll)s.returnForAll(r,t);else if(_isNullOrEmptyArray(r))_isNullOrEmptyArray(t)?o():i(t);else{var u=_normalizeError(r);_isNullOrEmptyArray(t)?n(u):e(u,t)}s.afterAll&&s.afterAll()}var a=t||{},s={beforeAll:null,returnForAll:null,afterAll:null,beforeReturnErrorAndData:null,returnErrorAndData:returnErrorAndData,afterReturnErrorAndData:null,beforeReturnError:null,returnError:returnError,afterReturnError:null,beforeReturnData:null,returnData:returnData,afterReturnData:null,beforeReturnNotFound:null,returnNotFound:returnNotFound,afterReturnNotFound:null};for(var l in a)a.hasOwnProperty(l)&&s.hasOwnProperty(l)&&(s[l]=a[l]);return u}import{extend}from"itee-utils";var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath=function(r){return splitPathRe.exec(r).slice(1)},sep="/",delimiter=":",path={extname:extname,basename:basename,dirname:dirname,sep:sep,delimiter:delimiter,relative:relative,join:join,isAbsolute:isAbsolute,normalize:normalize,resolve:resolve},substr="b"==="ab".substr(-1)?function(r,t,e){return r.substr(t,e)}:function(r,t,e){return t<0&&(t=r.length+t),r.substr(t,e)};class TAbstractDatabase{constructor(r){this.routes={},this._dbDriver=null,this._autoConnectionTimer=null,this._parameters=extend({autoReconnectTimeout:1e4,plugins:[]},r),this.__init()}__init(){const r=path.join(__dirname,"..","node_modules"),t=this._parameters.plugins;for(let e=0,n=t.length;e<n;e++){const n=path.join(r,t[e]),i=require(n);this.__registerPlugin(i)}this._init()}_init(){}__registerPlugin(r){const t=r.routes;for(let r in t)this.routes[r]||(this.routes[r]=t[r]);this._registerPlugin(r)}_registerPlugin(r){}connect(){}startAutoConnect(){this._autoConnectionTimer||(this._autoConnectionTimer=setInterval(this.connect.bind(this),this._parameters.autoReconnectTimeout))}stopAutoConnect(){this._autoConnectionTimer&&(clearInterval(this._autoConnectionTimer),this._autoConnectionTimer=null)}close(){}on(r,t){}}class TAbstractDatabasePlugin{constructor(r){this.routes={}}}var iReturn={return:returnResponse,returnError:returnError,returnNotFound:returnNotFound,returnData:returnData,returnErrorAndData:returnErrorAndData};class TAbstractDataController{constructor(r){this._parameters=r}static __checkData(r,t,e){const n=t.body,i=t.params,o=t.query;return isDefined(n)&&n[r]?n[r]:isDefined(i)&&i[r]?i[r]:isDefined(o)&&o[r]?o[r]:void iReturn.returnError({title:"Erreur de paramètre",message:r+" n'existe pas dans les paramètres !"},e)}create(r,t){const e=r.body;if(isNullOrUndefined(e))return void iReturn.returnError({title:"Erreur de paramètre",message:"Aucun paramètre n'a été reçu !"},t);isArray(e)?this._createSome(e,t):this._createOne(e,t)}_createOne(r,t){}_createSome(r,t){}read(r,t){const e=r.body,n=r.params.id;t.set("Content-Type","application/json"),isDefined(e)?isNotEmptyObject(e)?this._readByObject(e,t):isNotEmptyArray(e)?this._readByArray(e,t):iReturn.returnError({title:"Erreur de paramètre",message:"La requête ne contient pas de données !"},t):isDefined(n)?this._readById(n,t):this._readAll(t)}_readById(r,t){}_readByArray(r,t){}_readByObject(r,t){}_readAll(r){}update(r,t){const e=r.body,n=r.params.id;isDefined(e)?isNotEmptyObject(e)?this._updateByObject(e,t):isNotEmptyArray(e)?this._updateByArray(e,t):iReturn.returnError({title:"Erreur de paramètre",message:"La requête ne contient pas de données !"},t):isDefined(n)?this._updateById(n,t):this._updateAll(t)}_updateById(r,t){}_updateByArray(r,t){}_updateByObject(r,t){}_updateAll(r){}delete(r,t){const e=r.body,n=r.params.id;isDefined(e)?isNotEmptyObject(e)?this._deleteByObject(e,t):isNotEmptyArray(e)?this._deleteByArray(e,t):iReturn.returnError({title:"Erreur de paramètre",message:"La requête ne contient pas de données !"},t):isDefined(n)?this._deleteById(n,t):this._deleteAll(t)}_deleteById(r,t){}_deleteByArray(r,t){}_deleteByObject(r,t){}_deleteAll(r){}}export{TAbstractDatabase,TAbstractDatabasePlugin,TAbstractDataController};
