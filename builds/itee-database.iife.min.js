this.Itee=this.Itee||{},this.Itee.Database=function(r,t){"use strict";function n(r,t){for(var n=0,e=r.length-1;e>=0;e--){var u=r[e];"."===u?r.splice(e,1):".."===u?(r.splice(e,1),n++):n&&(r.splice(e,1),n--)}if(t)for(;n--;n)r.unshift("..");return r}function e(){for(var r="",t=!1,e=arguments.length-1;e>=-1&&!t;e--){var u=e>=0?arguments[e]:"/";if("string"!=typeof u)throw new TypeError("Arguments to path.resolve must be strings");u&&(r=u+"/"+r,t="/"===u.charAt(0))}return r=n(c(r.split("/"),function(r){return!!r}),!t).join("/"),(t?"/":"")+r||"."}function u(r){var t=o(r),e="/"===I(r,-1);return(r=n(c(r.split("/"),function(r){return!!r}),!t).join("/"))||t||(r="."),r&&e&&(r+="/"),(t?"/":"")+r}function o(r){return"/"===r.charAt(0)}function i(){return u(c(Array.prototype.slice.call(arguments,0),function(r,t){if("string"!=typeof r)throw new TypeError("Arguments to path.join must be strings");return r}).join("/"))}function a(r,t){function n(r){for(var t=0;t<r.length&&""===r[t];t++);for(var n=r.length-1;n>=0&&""===r[n];n--);return t>n?[]:r.slice(t,n-t+1)}r=e(r).substr(1),t=e(t).substr(1);for(var u=n(r.split("/")),o=n(t.split("/")),i=Math.min(u.length,o.length),a=i,s=0;s<i;s++)if(u[s]!==o[s]){a=s;break}for(var f=[],s=a;s<u.length;s++)f.push("..");return(f=f.concat(o.slice(a))).join("/")}function s(r){var t=B(r),n=t[0],e=t[1];return n||e?(e&&(e=e.substr(0,e.length-1)),n+e):"."}function f(r,t){var n=B(r)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n}function l(r){return B(r)[3]}function c(r,t){if(r.filter)return r.filter(t);for(var n=[],e=0;e<r.length;e++)t(r[e],e,r)&&n.push(r[e]);return n}function d(r){return null!==r}function h(r){return null===r||void 0===r}function p(r){return null!==r&&void 0!==r}function m(r){if(null===r)return!0;if(void 0===r)return!0;if(r.length>0)return!1;if(0===r.length)return!0;for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function b(r){return!m(r)}function g(r){return d(r)&&"object"==typeof r&&!Array.isArray(r)}function y(r){return g(r)&&b(r)}function A(r){return Array.isArray(r)}function E(r){return A(r)&&b(r)}function v(r){return"string"==typeof r||r instanceof String}function _(r){return!r||r.constructor===Array&&0===r.length}function R(r){return r.constructor===Array}function D(r){return r===Object(r)}function j(r){var t=[];if(R(r))for(var n=0,e=r.length;n<e;++n)t=t.concat(j(r[n]));else if(D(r))if("ValidationError"===r.name){var u="",o=r.errors;for(var i in o)o.hasOwnProperty(i)&&(u+=o[i].message+"<br>");t.push({title:"Erreur de validation",message:u||"Aucun message d'erreur... Gloups !"})}else"VersionError"===r.name?t.push({title:"Erreur de base de donnée",message:"Aucun document correspondant n'as put être trouvé pour la requete !"}):t.push({title:r.title||"Erreur",message:r.message||"Aucun message d'erreur... Gloups !"});else{if(!v(r))throw new Error("Unknown error type: "+r+', please report your issue at "https://github.com/TristanVALCKE/i-return/issues"');t.push({title:"Erreur",message:r})}return t}function T(r){return"function"==typeof r?r():r.headersSent?void 0:r.status(204).end()}function F(r,t){return"function"==typeof t?t(r,null):t.headersSent?void 0:t.status(500).end(JSON.stringify(r))}function N(r,t){return"function"==typeof t?t(null,r):t.headersSent?void 0:t.status(200).end(JSON.stringify(r))}function O(r,t,n){return"function"==typeof n?n(r,t):n.headersSent?void 0:n.status(406).end(JSON.stringify({errors:r,data:t}))}function w(r,t){function n(t,n){s.beforeReturnErrorAndData&&s.beforeReturnErrorAndData(t,n),s.returnErrorAndData&&s.returnErrorAndData(t,n,r),s.afterReturnErrorAndData&&s.afterReturnErrorAndData(t,n)}function e(t){s.beforeReturnError&&s.beforeReturnError(t),s.returnError&&s.returnError(t,r),s.afterReturnError&&s.afterReturnError(t)}function u(t){s.beforeReturnData&&s.beforeReturnData(t),s.returnData&&s.returnData(t,r),s.afterReturnData&&s.afterReturnData(t)}function o(){s.beforeReturnNotFound&&s.beforeReturnNotFound(),s.returnNotFound&&s.returnNotFound(r),s.afterReturnNotFound&&s.afterReturnNotFound()}function i(r,t){if(s.beforeAll&&s.beforeAll(),s.returnForAll)s.returnForAll(r,t);else if(_(r))_(t)?o():u(t);else{var i=j(r);_(t)?e(i):n(i,t)}s.afterAll&&s.afterAll()}var a=t||{},s={beforeAll:null,returnForAll:null,afterAll:null,beforeReturnErrorAndData:null,returnErrorAndData:O,afterReturnErrorAndData:null,beforeReturnError:null,returnError:F,afterReturnError:null,beforeReturnData:null,returnData:N,afterReturnData:null,beforeReturnNotFound:null,returnNotFound:T,afterReturnNotFound:null};for(var f in a)a.hasOwnProperty(f)&&s.hasOwnProperty(f)&&(s[f]=a[f]);return i}var S=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,B=function(r){return S.exec(r).slice(1)},C={extname:l,basename:f,dirname:s,sep:"/",delimiter:":",relative:a,join:i,isAbsolute:o,normalize:u,resolve:e},I="b"==="ab".substr(-1)?function(r,t,n){return r.substr(t,n)}:function(r,t,n){return t<0&&(t=r.length+t),r.substr(t,n)};class P{constructor(r){this.routes={},this._dbDriver=null,this._autoConnectionTimer=null,this._parameters=null.extend({autoReconnectTimeout:1e4,plugins:[]},r),this.__init()}__init(){const r=C.join(__dirname,"..","node_modules"),t=this._parameters.plugins;for(let n=0,e=t.length;n<e;n++){const e=C.join(r,t[n]),u=require(e);this.__registerPlugin(u)}this._init()}_init(){}__registerPlugin(r){const t=r.routes;for(let r in t)this.routes[r]||(this.routes[r]=t[r]);this._registerPlugin(r)}_registerPlugin(r){}connect(){}startAutoConnect(){this._autoConnectionTimer||(this._autoConnectionTimer=setInterval(this.connect.bind(this),this._parameters.autoReconnectTimeout))}stopAutoConnect(){this._autoConnectionTimer&&(clearInterval(this._autoConnectionTimer),this._autoConnectionTimer=null)}close(){}on(r,t){}}class q{constructor(r){this.routes={}}}var x={return:w,returnError:F,returnNotFound:T,returnData:N,returnErrorAndData:O};class L{constructor(r){this._parameters=r}static __checkData(r,t,n){const e=t.body,u=t.params,o=t.query;return p(e)&&e[r]?e[r]:p(u)&&u[r]?u[r]:p(o)&&o[r]?o[r]:void x.returnError({title:"Erreur de paramètre",message:r+" n'existe pas dans les paramètres !"},n)}create(r,t){const n=r.body;if(h(n))return void x.returnError({title:"Erreur de paramètre",message:"Aucun paramètre n'a été reçu !"},t);A(n)?this._createSome(n,t):this._createOne(n,t)}_createOne(r,t){}_createSome(r,t){}read(r,t){const n=r.body,e=r.params.id;t.set("Content-Type","application/json"),p(n)?y(n)?this._readByObject(n,t):E(n)?this._readByArray(n,t):x.returnError({title:"Erreur de paramètre",message:"La requête ne contient pas de données !"},t):p(e)?this._readById(e,t):this._readAll(t)}_readById(r,t){}_readByArray(r,t){}_readByObject(r,t){}_readAll(r){}update(r,t){const n=r.body,e=r.params.id;p(n)?y(n)?this._updateByObject(n,t):E(n)?this._updateByArray(n,t):x.returnError({title:"Erreur de paramètre",message:"La requête ne contient pas de données !"},t):p(e)?this._updateById(e,t):this._updateAll(t)}_updateById(r,t){}_updateByArray(r,t){}_updateByObject(r,t){}_updateAll(r){}delete(r,t){const n=r.body,e=r.params.id;p(n)?y(n)?this._deleteByObject(n,t):E(n)?this._deleteByArray(n,t):x.returnError({title:"Erreur de paramètre",message:"La requête ne contient pas de données !"},t):p(e)?this._deleteById(e,t):this._deleteAll(t)}_deleteById(r,t){}_deleteByArray(r,t){}_deleteByObject(r,t){}_deleteAll(r){}}return r.TAbstractDatabase=P,r.TAbstractDatabasePlugin=q,r.TAbstractDataController=L,r}({});
