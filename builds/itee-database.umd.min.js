!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((r.Itee=r.Itee||{},r.Itee.Database={}))}(this,function(r){"use strict";function t(r){return null!==r}function e(r){return null===r||void 0===r}function n(r){return null!==r&&void 0!==r}function o(r){if(null===r)return!0;if(void 0===r)return!0;if(r.length>0)return!1;if(0===r.length)return!0;for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function u(r){return!o(r)}function i(r){return t(r)&&"object"==typeof r&&!Array.isArray(r)}function a(r){return i(r)&&u(r)}function s(r){return Array.isArray(r)}function f(r){return s(r)&&u(r)}function c(r){return"string"==typeof r||r instanceof String}function l(r){return!r||r.constructor===Array&&0===r.length}function d(r){return r.constructor===Array}function h(r){return r===Object(r)}function p(r){var t=[];if(d(r))for(var e=0,n=r.length;e<n;++e)t=t.concat(p(r[e]));else if(h(r))if("ValidationError"===r.name){var o="",u=r.errors;for(var i in u)u.hasOwnProperty(i)&&(o+=u[i].message+"<br>");t.push({title:"Erreur de validation",message:o||"Aucun message d'erreur... Gloups !"})}else"VersionError"===r.name?t.push({title:"Erreur de base de donnée",message:"Aucun document correspondant n'as put être trouvé pour la requete !"}):t.push({title:r.title||"Erreur",message:r.message||"Aucun message d'erreur... Gloups !"});else{if(!c(r))throw new Error("Unknown error type: "+r+', please report your issue at "https://github.com/TristanVALCKE/i-return/issues"');t.push({title:"Erreur",message:r})}return t}function y(r){return"function"==typeof r?r():r.headersSent?void 0:r.status(204).end()}function m(r,t){return"function"==typeof t?t(r,null):t.headersSent?void 0:t.status(500).end(JSON.stringify(r))}function A(r,t){return"function"==typeof t?t(null,r):t.headersSent?void 0:t.status(200).end(JSON.stringify(r))}function b(r,t,e){return"function"==typeof e?e(r,t):e.headersSent?void 0:e.status(406).end(JSON.stringify({errors:r,data:t}))}function E(r,t){function e(t,e){s.beforeReturnErrorAndData&&s.beforeReturnErrorAndData(t,e),s.returnErrorAndData&&s.returnErrorAndData(t,e,r),s.afterReturnErrorAndData&&s.afterReturnErrorAndData(t,e)}function n(t){s.beforeReturnError&&s.beforeReturnError(t),s.returnError&&s.returnError(t,r),s.afterReturnError&&s.afterReturnError(t)}function o(t){s.beforeReturnData&&s.beforeReturnData(t),s.returnData&&s.returnData(t,r),s.afterReturnData&&s.afterReturnData(t)}function u(){s.beforeReturnNotFound&&s.beforeReturnNotFound(),s.returnNotFound&&s.returnNotFound(r),s.afterReturnNotFound&&s.afterReturnNotFound()}function i(r,t){if(s.beforeAll&&s.beforeAll(),s.returnForAll)s.returnForAll(r,t);else if(l(r))l(t)?u():o(t);else{var i=p(r);l(t)?n(i):e(i,t)}s.afterAll&&s.afterAll()}var a=t||{},s={beforeAll:null,returnForAll:null,afterAll:null,beforeReturnErrorAndData:null,returnErrorAndData:b,afterReturnErrorAndData:null,beforeReturnError:null,returnError:m,afterReturnError:null,beforeReturnData:null,returnData:A,afterReturnData:null,beforeReturnNotFound:null,returnNotFound:y,afterReturnNotFound:null};for(var f in a)a.hasOwnProperty(f)&&s.hasOwnProperty(f)&&(s[f]=a[f]);return i}class _{constructor(r,t=[],e=1e4){this.routes={},this._driver=r,this._plugins=t,this._autoReconnectTimeout=e,this._autoConnectionTimer=null,this.__init()}__init(){const r=this._plugins;for(let t=0,e=r.length;t<e;t++){const e=r[t];let n=void 0;try{n=require(e)}catch(r){continue}this.__registerPlugin(n)}this._init()}_init(){}__registerPlugin(r){r.registerTo(this._driver);const t=r.routes;for(let r in t)this.routes[r]||(this.routes[r]=t[r])}connect(){}startAutoConnect(){this._autoConnectionTimer||(this._autoConnectionTimer=setInterval(this.connect.bind(this),this._autoReconnectTimeout))}stopAutoConnect(){this._autoConnectionTimer&&(clearInterval(this._autoConnectionTimer),this._autoConnectionTimer=null)}close(r){}on(r,t){}}class g{constructor(r){this.routes={}}}var R={return:E,returnError:m,returnNotFound:y,returnData:A,returnErrorAndData:b};class v{constructor(r){this._parameters=r}static __checkData(r,t,e){const o=t.body,u=t.params,i=t.query;return n(o)&&o[r]?o[r]:n(u)&&u[r]?u[r]:n(i)&&i[r]?i[r]:void R.returnError({title:"Erreur de paramètre",message:r+" n'existe pas dans les paramètres !"},e)}create(r,t){const n=r.body;if(e(n))return void R.returnError({title:"Erreur de paramètre",message:"Aucun paramètre n'a été reçu !"},t);s(n)?this._createSome(n,t):this._createOne(n,t)}_createOne(r,t){}_createSome(r,t){}read(r,t){const e=r.body,o=r.params.id;t.set("Content-Type","application/json"),n(e)?a(e)?this._readByObject(e,t):f(e)?this._readByArray(e,t):R.returnError({title:"Erreur de paramètre",message:"La requête ne contient pas de données !"},t):n(o)?this._readById(o,t):this._readAll(t)}_readById(r,t){}_readByArray(r,t){}_readByObject(r,t){}_readAll(r){}update(r,t){const e=r.body,o=r.params.id;n(e)?a(e)?this._updateByObject(e,t):f(e)?this._updateByArray(e,t):R.returnError({title:"Erreur de paramètre",message:"La requête ne contient pas de données !"},t):n(o)?this._updateById(o,t):this._updateAll(t)}_updateById(r,t){}_updateByArray(r,t){}_updateByObject(r,t){}_updateAll(r){}delete(r,t){const e=r.body,o=r.params.id;n(e)?a(e)?this._deleteByObject(e,t):f(e)?this._deleteByArray(e,t):R.returnError({title:"Erreur de paramètre",message:"La requête ne contient pas de données !"},t):n(o)?this._deleteById(o,t):this._deleteAll(t)}_deleteById(r,t){}_deleteByArray(r,t){}_deleteByObject(r,t){}_deleteAll(r){}}r.TAbstractDatabase=_,r.TAbstractDatabasePlugin=g,r.TAbstractDataController=v,Object.defineProperty(r,"__esModule",{value:!0})});
